!function(){"use strict";angular.module("rateApp.rate-people-detail",["rateApp.rate-people-common"])}(),function(){"use strict";function e(e,t,a,r,i,n,l){function s(){function s(){return i.getPerson(e.userid).then(function(t){return g.person=t,g.person&&g.person!=={}?g.person:n.getData(l.assets.ASSETS_DATA+"/personajes.json").then(function(t){for(var a,r=0;r<t.length;r++)if(a=t[r],a._id===e.userid)return g.person=a,g.person})})}function d(){return r.getReviews(e.userid).then(function(t){return g.reviews=t,g.reviews&&0!==g.reviews.length?g.reviews:n.getData(l.assets.ASSETS_DATA+"/valoraciones.json").then(function(t){for(var a,r=[],i=0;i<t.length;i++)a=t[i],a.personId===e.userid&&r.push(a);return g.reviews=r,g.reviews})})}t.$emit("startLoading","RateDetailController");var c=[s(),d()];return a.all(c).then(function(){o(),t.$emit("endLoading","RateDetailController")})}function o(){v()}function d(){$("#myModal").modal("toggle")}function c(){g.review.personId=e.userid,g.review.createDate=Date.now(),r.addReview(g.review).then(function(e){e?(g.reviews.push(e),w("OK!","Review added successfully")):b("Error!","Review not added. ")})["catch"](function(e){b("Error!","Review not added. "+e)}),v(),$("#myModal").modal("toggle")}function v(){g.review={stars:-1,description:"",personId:""},t.$emit("resetRatingStar")}function u(){v()}function p(){var e=event.target.id;r.deleteReview(e).then(function(){for(var t=0;t<g.reviews.length;t++)if(g.reviews[t]._id===e){g.reviews.splice(t,1),w("OK!","Review removed successfully");break}})["catch"](function(e){b("Error!","Review not removed. "+e)})}function m(){return g.reviews&&g.reviews.length>0}function w(e,a){var r={status:"OK",state:e,message:a};t.$emit("validation",r)}function b(e,a){var r={status:"ERROR",state:e,message:a};t.$emit("validation",r)}var g=this;g.validation={},g.person={},g.reviews=[],g.review={},g.openReview=d,g.addReview=c,g.cancelReview=u,g.deleteReview=p,g.hasReviews=m,s()}angular.module("rateApp.rate-people-detail").controller("RateDetailController",e),e.$inject=["$stateParams","$scope","$q","ReviewService","PeopleService","DataService","RateAssets"]}(),function(){"use strict";function e(){return{restrict:"E",controller:"RateDetailController",controllerAs:"rateDetailCtrl",templateUrl:"src/rate-people-detail/rate-detail.template.html",link:t}}function t(e,t){var a=document.querySelector("#input-star-edit",t);$(a).on("rating.change",function(t,a){e.rateDetailCtrl.review.stars=a;var r={id:"input-star-readonly",stars:a};e.$broadcast("updateRatingStar",r)})}angular.module("rateApp.rate-people-detail").directive("rateDetail",e),t.$inject=["$scope","$element"]}(),function(){"use strict";angular.module("rateApp.rate-people-detail").run(["$templateCache",function(e){e.put("src/rate-people-detail/rate-detail.template.html",'<style type="text/css">.modal-backdrop {\r\n        z-index: -1;\r\n    }</style><rate-alert></rate-alert><div class="container"><div class="page-header"><h2>Valora a {{rateDetailCtrl.person.nick}}</h2></div><div class="panel panel-primary"><div class="panel-body"><div class="row"><div class="col-lg-6"><div style="text-align: center"><h2>{{rateDetailCtrl.person.nick}}</h2><img class="img-circle" ng-src="{{rateDetailCtrl.person.profileImg}}" alt="Generic placeholder image" width="140" height="140"><p>{{rateDetailCtrl.person.job}}</p><a href="#/people" class="btn btn-primary">Volver a personajes</a> <button type="button" class="btn btn-primary" ng-click="rateDetailCtrl.openReview()">Añadir valoración</button></div><div id="myModal" class="modal fade" role="dialog" data-backdrop="false"><div class="modal-dialog"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" ng-click="rateDetailCtrl.cancelReview()">&times;</button><h4 class="modal-title">Añadir valoración</h4></div><div class="modal-body"><form name="reviewForm" ng-submit="rateDetailCtrl.addReview()"><h3>Vista Previa</h3><blockqoute><b>Valoración: <input input-star stars="{{rateDetailCtrl.review.stars}}" id="input-star-readonly" class="rating" data-min="0" data-max="5" data-step="1" data-show-caption="false" data-readonly="true" data-show-clear="false"></b><b>Comentario:</b><br>{{rateDetailCtrl.review.description}}<br></blockqoute><h3>Edit</h3><blockqoute><b>Valoración: <input input-star stars="{{rateDetailCtrl.review.stars}}" id="input-star-edit" class="rating" data-min="0" data-max="5" data-step="1" data-show-caption="false"></b><b>Comentario:</b><br><textarea ng-model="rateDetailCtrl.review.description" class="form-control"></textarea><div class="modal-footer"><input type="submit" class="btn btn-primary" value="Save Review"> <input type="button" class="btn btn-default" value="Cancel" ng-click="rateDetailCtrl.cancelReview()" data-dismiss="modal"></div></blockqoute></form></div></div></div></div></div><!-- /.col-lg-6 --><div class="col-lg-6"><b ng-hide="rateDetailCtrl.hasReviews()">No hay ninguna valoración</b><blockquote ng-repeat="revw in rateDetailCtrl.reviews"><b>Valoración: <input input-star stars="{{revw.stars}}" id="input-star-readonly-{{revw._id}}" class="rating rating-list" data-min="0" data-max="5" data-step="1" data-show-caption="false" data-readonly="true" data-show-clear="false" data-size="xs"></b><b>Comentario:</b><br>{{revw.description}}<br><b>Creado en:</b><br>{{revw.createDate | date:\'yyyy-MM-dd HH:mm:ss Z\'}}<br><button type="button" id="{{revw._id}}" class="btn btn-default" ng-click="rateDetailCtrl.deleteReview()">Borrar valoración</button></blockquote></div><!-- /.col-lg-6 --></div></div></div></div>')}])}();